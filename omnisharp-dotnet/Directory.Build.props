<Project>

  <PropertyGroup Label="Package locking">
    <RestorePackagesWithLockFile>true</RestorePackagesWithLockFile>
  </PropertyGroup>

  <!-- ****************************************************-->
  <!-- OmniSharp assembly references                       -->
  <!-- ****************************************************-->
  <PropertyGroup>
    <!-- TODO: this version needs to be kept in sync with
      1) the version in the POM for the ITs
      2) the version in the POM of the SonarLint.IntelliJ repo -->
    <OmniSharpVersion>v1.37.9</OmniSharpVersion>

    <OmniSharpLocalDownloadDir>$(MSBuildThisFileDirectory).omnisharp\$(OmniSharpVersion)</OmniSharpLocalDownloadDir>
    <OmniSharpUnzippedDir>$(OmniSharpLocalDownloadDir)\unzipped</OmniSharpUnzippedDir>
    
  </PropertyGroup>
  <Import Project="build\DownloadOmniSharp.targets"/>

  <ItemGroup Label="OmniSharp assemblies">
    <Reference Include="$(OmniSharpUnzippedDir)\omnisharp\OmniSharp.Abstractions.dll" />
    <Reference Include="$(OmniSharpUnzippedDir)\omnisharp\OmniSharp.Shared.dll" />
    <Reference Include="$(OmniSharpUnzippedDir)\omnisharp\OmniSharp.Roslyn.dll" />
    <Reference Include="$(OmniSharpUnzippedDir)\omnisharp\OmniSharp.Roslyn.CSharp.dll" />
  </ItemGroup>

  <!-- ****************************************************-->
  <!-- sonar-dotnet assembly references                       -->
  <!-- ****************************************************-->
  <PropertyGroup>
    <SonarDotnetAnalyzerVersion>8.24.0.32949</SonarDotnetAnalyzerVersion>
  </PropertyGroup>
  
  <ItemGroup Label="SonarDotnetAnalyzers">
    <PackageReference Include="SonarAnalyzer.CSharp" 
                      Version="$(SonarDotnetAnalyzerVersion)" 
                      IncludeAssets="none" 
                      ExcludeAssets="all" 
                      GeneratePathProperty="true" />
  </ItemGroup>

  <Target Name="IncludeSonarAnalyzersInOutput" BeforeTargets="BeforeBuild">
    <Message Importance="high" Text="XXX Locating SonarAnalyzer assemblies to copy: $(PkgSonarAnalyzer_CSharp)" />
    <ItemGroup>
      <AnalyzerFiles Include="$(PkgSonarAnalyzer_CSharp)\**\analyzers\*.*"/>
    </ItemGroup>
    <Copy SourceFiles="@(AnalyzerFiles)" 
          DestinationFolder="$(OutputPath)analyzers\" />
  </Target>

</Project>